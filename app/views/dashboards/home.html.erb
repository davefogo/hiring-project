<!-- <h1>BigCommerce HQ</h1> -->

<nav class="navbar navbar-dark sticky-top bg-dark flex-md-nowrap p-0 shadow">
  <a class="navbar-brand col-md-3 col-lg-2 mr-0 px-3" href="https://www.bigcommerce.com/"> 
    <%= image_tag('bc-logo-white.png', :alt => "bigCommerce Logo") %>  
  </a>

  <button class="navbar-toggler position-absolute d-md-none collapsed" type="button" data-toggle="collapse" data-target="#sidebarMenu" aria-controls="sidebarMenu" aria-expanded="false" aria-label="Toggle navigation">
    <!-- <span class="navbar-toggler-icon"></span> -->
    <a class="navbar-brand col-md-3 col-lg-2 mr-0 px-3" href="https://www.bigcommerce.com/"> 
    <%= image_tag('bc-logo-white.png', :alt => "bigCommerce Logo") %>  
  </a>

  </button>
</nav>
    <main role="main" class="col-md-9 ml-sm-auto col-lg-10 px-md-4">
      <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
        <h1 class="h2">Dashboard</h1>
      </div>
      <div id="container" style="height: 400px;"></div>
      <div id="container2" style="height: 400px;"></div>


      <script>

        function hourNormalizer(time) {
          let fixedTime;

          if (time === "0") {
            fixedTime = "0:00";
          } else if (time.length === 3) {
            fixedTime = time.slice(0, 1) + ":" + time.slice(1)
          } else {
            fixedTime = time.slice(0, 2) + ":" + time.slice(2)
          }

          return fixedTime;
        }

        $(function() {
          //historical
          let today = new Date()
              let UTCOffsetMinutes = today.getTimezoneOffset();
              let UTCOffset = UTCOffsetMinutes * 60000;
              let now = Date.now();
              console.log('update charts')

            $.ajax({
              url: "http://api.worldweatheronline.com/premium/v1/past-weather.ashx?key=5c868c1933b54b6685c10828203006&q=30.404251,-97.849442&format=json&date=2020-06-01&enddate=2020-06-30&tp=1&callback=?",
              dataType: 'jsonp',
              async: false,
              success: function(data) {
              let dataArray = []; 
              let days = data.data.weather;

              for (let i = 0 ; i < days.length; i++) {
                let day = days[i];
                let date = day.date.split("-").join("/");
                let hourlyTemps = day.hourly;
                
                for (let j = 0; j < hourlyTemps.length; j++) {
                  let hours = hourlyTemps[j];
                  let time = hourNormalizer(hours.time);
                  let dateTime = date + " " + time;
                  let unixTime = Date.parse(dateTime);
                  let unixTimeCST = unixTime - UTCOffset;
                  let temp = parseInt(hours.tempF);

                  if (unixTime < now) {
                    dataArray.push([unixTimeCST, temp]);  
                  }
                }
              }

              let weatherForAustin = Highcharts.stockChart("container", {
                rangeSelector : {
                  selected: 1
                },
                title: {
                  text: "Weather for Austin HQ"
                },
                legend: {
                  enabled: true
                },
                series: [
                    {
                      name: "Historical",
                      data: dataArray
                    }     
                  ]          
              }, function(weatherForAustin) {
              $.ajax({
                url: "http://api.worldweatheronline.com/premium/v1/weather.ashx?key=5c868c1933b54b6685c10828203006&q=30.404251,-97.849442&format=json&num_of_days=2&tp=1&callback=?",
                dataType: 'jsonp',
                async: false,
                success: function(data2) {
                  let dataArray2 = []; 
                  let days = data2.data.weather;

                  for (let i = 0 ; i < days.length; i++) {
                    let day = days[i];
                    let date = day.date.split("-").join("/");
                    let hourlyTemps = day.hourly;
                    
                    for (let j = 0; j < hourlyTemps.length; j++) {
                      let hours = hourlyTemps[j];
                      let time = hourNormalizer(hours.time);
                      let dateTime = date + " " + time;
                      let unixTime = Date.parse(dateTime);
                      let unixTimeCST = unixTime - UTCOffset;
                      let temp = parseInt(hours.tempF);

                      if (unixTime > now) {
                        dataArray2.push([unixTimeCST, temp]);  
                      }
                    }
                  }

                  weatherForAustin.addSeries({
                    name: "Forecast",
                    data: dataArray2
                  })           
                } 
              })
            })
          }
        })

            let minutes = 30;
            setInterval(function() {
              let today = new Date()
              let UTCOffsetMinutes = today.getTimezoneOffset();
              let UTCOffset = UTCOffsetMinutes * 60000;
              let now = Date.now();
              console.log('update charts')

            $.ajax({
              url: "http://api.worldweatheronline.com/premium/v1/past-weather.ashx?key=5c868c1933b54b6685c10828203006&q=30.404251,-97.849442&format=json&date=2020-06-01&enddate=2020-06-30&tp=1&callback=?",
              dataType: 'jsonp',
              async: false,
              success: function(data) {
              let dataArray = []; 
              let days = data.data.weather;

              for (let i = 0 ; i < days.length; i++) {
                let day = days[i];
                let date = day.date.split("-").join("/");
                let hourlyTemps = day.hourly;
                
                for (let j = 0; j < hourlyTemps.length; j++) {
                  let hours = hourlyTemps[j];
                  let time = hourNormalizer(hours.time);
                  let dateTime = date + " " + time;
                  let unixTime = Date.parse(dateTime);
                  let unixTimeCST = unixTime - UTCOffset;
                  let temp = parseInt(hours.tempF);

                  if (unixTime < now) {
                    dataArray.push([unixTimeCST, temp]);  
                  }
                }
              }

              let weatherForAustin = Highcharts.stockChart("container", {
                rangeSelector : {
                  selected: 1
                },
                title: {
                  text: "Weather for Austin HQ"
                },
                series: [
                    {
                      name: "Austin HQ Historical",
                      data: dataArray
                    }     
                  ]          
              }, function(weatherForAustin) {
              $.ajax({
                url: "http://api.worldweatheronline.com/premium/v1/weather.ashx?key=5c868c1933b54b6685c10828203006&q=30.404251,-97.849442&format=json&num_of_days=2&tp=1&callback=?",
                dataType: 'jsonp',
                async: false,
                success: function(data2) {
                  let dataArray2 = []; 
                  let days = data2.data.weather;

                  for (let i = 0 ; i < days.length; i++) {
                    let day = days[i];
                    let date = day.date.split("-").join("/");
                    let hourlyTemps = day.hourly;
                    
                    for (let j = 0; j < hourlyTemps.length; j++) {
                      let hours = hourlyTemps[j];
                      let time = hourNormalizer(hours.time);
                      let dateTime = date + " " + time;
                      let unixTime = Date.parse(dateTime);
                      let unixTimeCST = unixTime - UTCOffset;
                      let temp = parseInt(hours.tempF);

                      if (unixTime > now) {
                        dataArray2.push([unixTimeCST, temp]);  
                      }
                    }
                  }

                  weatherForAustin.addSeries({
                    name: "Austin HQ Forecast",
                    data: dataArray2
                  })           
                } 
              })
            })
          }
        })
          }, 60000 * minutes)
      })  
      </script>
      <a href="https://www.bigcommerce.com/"> 
        <%= image_tag('bc-logo-black.png', :alt => "bigCommerce Logo") %>
      </a> 
    </main>
  </div>
</div>





























































